@model OmegaStore.Models.WebsiteInfo

@{
    ViewData["Title"] = "Sửa Thông Tin Website";
}

@section Styles {
    <link rel="stylesheet" href="~/admin/css/All.css">
	@* ckeditor *@
    <link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/44.1.0/ckeditor5.css" />

	<style>
		fieldset.text.py-5 p[data-placeholder] > span {
			display: block;
		}

		fieldset.text.py-5 p[data-placeholder] > span iframe {
			width: 100%;
		}
	</style>
}

@section Scripts {
    <script src="~/admin/js/zoom.js"></script>
    <script src="~/admin/js/tinymce/tinymce.min.js"></script>
    <script src="~/admin/js/tinymce/tinymce-custom.js"></script>
    <script src="~/admin/js/switcher.js"></script>
    <script src="~/admin/js/theme-settings.js"></script>
	@* ckeditor *@
    <script src="https://cdn.ckeditor.com/ckeditor5/44.1.0/ckeditor5.umd.js"></script>

	@* ckeditor *@
	<script>
		const {
			ClassicEditor,
			Autoformat,
			AutoImage,
			AutoLink,
			Autosave,
			Bold,
			CodeBlock,
			Essentials,
			FindAndReplace,
			FontBackgroundColor,
			FontColor,
			FontFamily,
			FontSize,
			FullPage,
			GeneralHtmlSupport,
			Heading,
			HorizontalLine,
			HtmlComment,
			HtmlEmbed,
			ImageBlock,
			ImageCaption,
			ImageInline,
			ImageInsert,
			ImageInsertViaUrl,
			ImageResize,
			ImageStyle,
			ImageTextAlternative,
			ImageToolbar,
			ImageUpload,
			Italic,
			Link,
			LinkImage,
			List,
			ListProperties,
			Paragraph,
			PasteFromOffice,
			RemoveFormat,
			ShowBlocks,
			SimpleUploadAdapter,
			SourceEditing,
			SpecialCharacters,
			SpecialCharactersArrows,
			SpecialCharactersCurrency,
			SpecialCharactersEssentials,
			SpecialCharactersLatin,
			SpecialCharactersMathematical,
			SpecialCharactersText,
			Strikethrough,
			TextTransformation,
			TodoList,
			Underline
		} = window.CKEDITOR;

		const LICENSE_KEY =
			'eyJhbGciOiJFUzI1NiJ9.eyJleHAiOjE3MzgwMjIzOTksImp0aSI6IjYwYTY0YTA5LTMxYTMtNDk3NC1iZDA2LTI1MWViZTRjMzA0ZCIsInVzYWdlRW5kcG9pbnQiOiJodHRwczovL3Byb3h5LWV2ZW50LmNrZWRpdG9yLmNvbSIsImRpc3RyaWJ1dGlvbkNoYW5uZWwiOlsiY2xvdWQiLCJkcnVwYWwiLCJzaCJdLCJ3aGl0ZUxhYmVsIjp0cnVlLCJsaWNlbnNlVHlwZSI6InRyaWFsIiwiZmVhdHVyZXMiOlsiKiJdLCJ2YyI6ImMxNWZkODZiIn0.jmc5zEe_BZ-fOO4pfjsPxvbySUXbnWdhZbmQTt91vYyHCZFwTX1PZfDlOPpTS1xUReuCv1bXQI1dZB93Wp1ewg';

		const editorConfig = {
			toolbar: {
				items: [
					'sourceEditing',
					'showBlocks',
					'findAndReplace',
					'|',
					'heading',
					'|',
					'fontSize',
					'fontFamily',
					'fontColor',
					'fontBackgroundColor',
					'|',
					'bold',
					'italic',
					'underline',
					'strikethrough',
					'removeFormat',
					'|',
					'specialCharacters',
					'horizontalLine',
					'link',
					'insertImage',
					'codeBlock',
					'htmlEmbed',
					'|',
					'bulletedList',
					'numberedList',
					'todoList'
				],
				shouldNotGroupWhenFull: false
			},
			plugins: [
				Autoformat,
				AutoImage,
				AutoLink,
				Autosave,
				Bold,
				CodeBlock,
				Essentials,
				FindAndReplace,
				FontBackgroundColor,
				FontColor,
				FontFamily,
				FontSize,
				FullPage,
				GeneralHtmlSupport,
				Heading,
				HorizontalLine,
				HtmlComment,
				HtmlEmbed,
				ImageBlock,
				ImageCaption,
				ImageInline,
				ImageInsert,
				ImageInsertViaUrl,
				ImageResize,
				ImageStyle,
				ImageTextAlternative,
				ImageToolbar,
				ImageUpload,
				Italic,
				Link,
				LinkImage,
				List,
				ListProperties,
				Paragraph,
				PasteFromOffice,
				RemoveFormat,
				ShowBlocks,
				SimpleUploadAdapter,
				SourceEditing,
				SpecialCharacters,
				SpecialCharactersArrows,
				SpecialCharactersCurrency,
				SpecialCharactersEssentials,
				SpecialCharactersLatin,
				SpecialCharactersMathematical,
				SpecialCharactersText,
				Strikethrough,
				TextTransformation,
				TodoList,
				Underline
			],
			fontFamily: {
				supportAllValues: true
			},
			fontSize: {
				options: [10, 12, 14, 'default', 18, 20, 22],
				supportAllValues: true
			},
			heading: {
				options: [
					{
						model: 'paragraph',
						title: 'Paragraph',
						class: 'ck-heading_paragraph'
					},
					{
						model: 'heading1',
						view: 'h1',
						title: 'Heading 1',
						class: 'ck-heading_heading1'
					},
					{
						model: 'heading2',
						view: 'h2',
						title: 'Heading 2',
						class: 'ck-heading_heading2'
					},
					{
						model: 'heading3',
						view: 'h3',
						title: 'Heading 3',
						class: 'ck-heading_heading3'
					},
					{
						model: 'heading4',
						view: 'h4',
						title: 'Heading 4',
						class: 'ck-heading_heading4'
					},
					{
						model: 'heading5',
						view: 'h5',
						title: 'Heading 5',
						class: 'ck-heading_heading5'
					},
					{
						model: 'heading6',
						view: 'h6',
						title: 'Heading 6',
						class: 'ck-heading_heading6'
					}
				]
			},
			htmlSupport: {
				allow: [
					{
						name: /^.*$/,
						styles: true,
						attributes: true,
						classes: true
					}
				]
			},
			image: {
				toolbar: [
					'toggleImageCaption',
					'imageTextAlternative',
					'|',
					'imageStyle:inline',
					'imageStyle:wrapText',
					'imageStyle:breakText',
					'|',
					'resizeImage'
				]
			},
			licenseKey: LICENSE_KEY,
			link: {
				addTargetToExternalLinks: true,
				defaultProtocol: 'https://',
				decorators: {
					toggleDownloadable: {
						mode: 'manual',
						label: 'Downloadable',
						attributes: {
							download: 'file'
						}
					}
				}
			},
			list: {
				properties: {
					styles: true,
					startIndex: true,
					reversed: true
				}
			},
			placeholder: 'Gõ hoặc dán nội dung vào đây!'
		};

		ClassicEditor.create(document.querySelector('#contact-info'), editorConfig);
		ClassicEditor.create(document.querySelector('#policy'), editorConfig);
		ClassicEditor.create(document.querySelector('#fanpage'), editorConfig);
		ClassicEditor.create(document.querySelector('#map'), editorConfig);
	</script>
    
	<script>
		$(document).ready(function () {
			let currentLogo = $("#logo-img").attr("src");

			// Bắt sự kiện input file thay đổi
			$("input#LogoUpload").on("change", function () {
				$("#logo-is-deleted").val("false");

				// Kiểm tra đã chọn ảnh chưa
				if ($(this)[0].files && $(this)[0].files[0]) {
					var reader = new FileReader();

					// callback này thực hiện khi đọc xong
					reader.onload = function (e) {
						$("#logo-img").attr("src", e.target.result);
					}

					// Đọc tệp và trả về nội dung (dạng url dữ liệu base64)
					reader.readAsDataURL($(this)[0].files[0]);
				}
				else {
					// Hiển thị lại ảnh hiện tại
					$("#logo-img").attr("src", currentLogo);
				}
			});

			$("#logo-del-btn").on("click", function () {
				$("#logo-is-deleted").val("true");
				$("#logo-img").attr("src", "");

				if ($("input#LogoUpload")[0].files && $("input#LogoUpload")[0].files[0]) {
					// Reset input
					$("input#LogoUpload").val("");
				}
			});

			$("#website-info-form").on("submit", function (e) {
				e.preventDefault();

				Swal.fire({
					title: "Xác nhận",
					text: "Bạn có đồng ý cập nhật không",
					icon: "info",
					showCancelButton: true,
					confirmButtonColor: "#3085d6",
					cancelButtonColor: "#d33",
					confirmButtonText: "Đồng ý",
					cancelButtonText: "Không"
				}).then((result) => {
					if (result.isConfirmed) {
						var formData = new FormData($(this)[0]);
						$.ajax({
							url: "/Admin/WebsiteInfo/Update",
							method: "POST",
							data: formData,
							processData: false, // Ngăn jQuery chuyển dữ liệu -> chuỗi
							contentType: false, // Ngăn jQuery thiết lập và để browser tự lấy kiểu nội dung trong form
							success: function (res) {
								if (res.success) {
									Swal.fire({
										title: "Thành công",
										text: res.title,
										icon: "success"
									}).then(() => window.location.reload());
								}
							},
							error: function (error) {
								alert(`Lỗi: ${error}`);
							}
						});
					}
				});
			})
		});
	</script>
}

<div class="main-content">
    <!-- main-content-wrap -->
    <div class="main-content-inner">
        <!-- main-content-wrap -->
        <div class="main-content-wrap">
            <div class="flex items-center flex-wrap justify-between gap20 mb-27">
                <h3>Sửa thông tin website</h3>
                <ul class="breadcrumbs flex items-center flex-wrap justify-start gap10">
                    <li>
                        <a href="index.html">
                            <div class="text-tiny">Tổng quan</div>
                        </a>
                    </li>
                    <li>
                        <i class="icon-chevron-right"></i>
                    </li>
                    <li>
                        <div class="text-tiny">Sửa thông tin website</div>
                    </li>
                </ul>
            </div>
            <!-- new-page-wrap -->
			<form class="form-new-page" id="website-info-form" asp-area="Admin" asp-controller="WebsiteInfo" asp-action="Update" method="post" enctype="multipart/form-data">
                <div class="new-page-wrap">
                    <div class="left">
                        <div class="wg-box">
                            <div class="widget-tabs">
                                <div class="widget-content-tab">
                                    <div class="widget-content-inner active">
										<input type="hidden" name="Id" value="1" />
										<fieldset class="name py-5">
											<div class="body-title mb-10">Thông tin liên hệ:</div>
											<textarea type="text" asp-for="ContactInfo" id="contact-info">
												@Model.ContactInfo
											</textarea>
											<span asp-validation-for="ContactInfo" class="text-danger"></span>
										</fieldset>
										<fieldset class="content py-5">
											<div class="body-title mb-10">Trang cộng đồng:</div>
											<textarea type="text" asp-for="Fanpage" id="fanpage">
												@Model.Fanpage
											</textarea>
											<span asp-validation-for="Fanpage" class="text-danger"></span>
										</fieldset>
										<fieldset class="text py-5">
											<div class="body-title mb-10">Bản đồ:</div>
											<textarea type="text" asp-for="Map" id="map">
												@Model.Map
											</textarea>
											<span asp-validation-for="Map" class="text-danger"></span>
										</fieldset>
										<div class="choose-logo w-50 py-5">
											<span>Logo:</span>
											<input type="file" asp-for="LogoUpload" id="LogoUpload" class="file-input">
											<label asp-for="LogoUpload" class="choose-logo-button">Chọn tệp</label>
											<span asp-validation-for="LogoUpload" class="text-danger"></span>
											<input type="hidden" id="logo" name="Logo" value="@Model.Logo" />
										</div>
										<div class="d-flex align-items-end">
											<img src="~/img/@Model.Logo" alt="logo" id="logo-img" class="d-block border border-2 border-dark" width="120" />
											<input type="hidden" name="logoIsDeleted" id="logo-is-deleted" value="false" />
											<button type="button" class="btn btn-danger ms-3" id="logo-del-btn">Xóa logo</button>
										</div>
										<div class="box-update-info">
											<button class="block-update" style="font-size: 16px;">Cập nhật thông tin</button>
										</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <!-- /new-page-wrap -->
        </div>
        <!-- /main-content-wrap -->
    </div>
    <!-- /main-content-wrap -->
    <!-- bottom-page -->
    <div class="bottom-page">
        <div class="body-text">Copyright © 2024 Omega. Design with</div>
        <i class="icon-heart"></i>
        <div class="body-text">
            by
            <a href="#">Omega Group</a>
            All rights reserved.
        </div>
    </div>
    <!-- /bottom-page -->
</div>