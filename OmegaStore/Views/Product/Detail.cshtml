@model OmegaStore.Models.Review

@{
    ViewData["Title"] = "Chi tiết sản phẩm";
    var product = ViewBag.product as Product ?? new Product();
    var relatedProducts = ViewBag.relatedProducts as List<Product> ?? new List<Product>();
}

@section Styles {
    <link rel="stylesheet" href="~/css/product-detail.css">
}

<!-- Breadcrumb Start -->
<div class="breadcrumb-wrap">
    <div class="container">
        <ul class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Trang chủ</a></li>
            <li class="breadcrumb-item active">Chi tiết sản phẩm</li>
        </ul>
    </div>
</div>
<!-- Breadcrumb End -->
<!-- Product Detail Start -->
<div class="product-detail">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="product-detail-top">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="product-slider-single normal-slider">
                                @foreach (var p in product.ProductsImages)
                                {
                                    <img src="~/img/products/@p.Image">
                                }
                            </div>
                            <div class="product-slider-single-nav normal-slider">
                                @foreach (var p in product.ProductsImages)
                                {
                                    <div class="slider-nav-img"><img src="~/img/products/@p.Image"></div>
                                }
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div class="product-content">
                                <div class="title mb-5">
                                    <h2>@product.Name</h2>
                                </div>
                                <div class="info">
                                    <h4>Mã:</h4>
                                    <p>@product.ProductCode</p>
                                </div>
                                <div class="price">
                                    <h4>Giá:</h4>
                                    <p>@Math.Truncate(product.Price * (1 - product.DiscountRate / 100))đ <span style="font-size: 18px;">@Math.Truncate(product.Price)đ</span></p>
                                </div>
                                <div class="info">
                                    <h4>Trạng thái:</h4>
                                    <p>@(product.Stock > 0 ? "còn hàng" : "hết hàng")</p>
                                </div>
                                <div class="quantity mt-3">
                                    <div class="qty border border-secondary rounded-lg">
                                        <button class="btn-minus rounded-left"><i class="fa fa-minus"></i></button>
                                        <input type="text" value="1">
                                        <button class="btn-plus rounded-right"><i class="fa fa-plus"></i></button>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between font-weight-bold mb-4">
                                    <div class="flex-grow-1">Lượt bán: <span>20</span></div>
                                    <div class="flex-grow-1">
                                        <i class="fa fa-heart text-danger"></i>
                                        <span>(1121)</span>
                                    </div>
                                    <div class="info flex-grow-1">
                                        <div class="ratting">
                                            <i class="fa fa-star"></i>
                                            <span>(1000)</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="action">
                                    <a class="btn btn-outline-info" asp-controller="Cart" asp-action="Index">
                                        <i class="fa fa-shopping-cart"></i>Thêm vào giỏ
                                    </a>
                                    <a class="btn btn-outline-danger" asp-controller="Account" asp-action="Index">
                                        <i class="fa fa-heart"></i>Yêu thích
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row product-detail-bottom">
                    <div class="col-lg-12">
                        <ul class="nav nav-pills nav-justified">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="pill" href="#description">Mô tả</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#reviews">Đánh giá (@product.Reviews.Count)</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div id="description" class="container tab-pane active overflow-auto" style="height: 500px;">
                                @Html.Raw(product.Description)
                            </div>
                            <div id="reviews" class="container tab-pane fade">
                                <div class="reviews-submitted overflow-auto" style="max-height: 250px;">
                                    @if (product.Reviews.Count == 0)
                                    {
                                        <p>Hiện tại sản phẩm này chưa có đánh giá nào</p>
                                    }
                                    else
                                    {
                                        @foreach (var r in product.Reviews)
                                        {
                                            <div class="reviewer">@r.Fullname - <span>@r.CreatedAt</span></div>
                                            <p>
                                                @r.Comment
                                            </p>
                                            <div class="ratting">
                                                @for (var i = 1; i <= r.Rating; i++)
                                                {
                                                    <i class="fa fa-star"></i>
                                                }

                                                @for (var i = 1; i <= 5 - r.Rating; i++)
                                                {
                                                    <i class="far fa-star"></i>
                                                }
                                            </div>
                                        }
                                    }
                                </div>
                                <form method="post" asp-controller="Product" asp-action="Comment">
                                    <input type="hidden" name="ProductId" value="@product.Id" />
                                    <div class="reviews-submit">
                                        <h4>Đánh giá của bạn:</h4>
                                        <div class="ratting d-flex justify-content-end flex-row-reverse">
                                            <input type="radio" name="rating" value="5" id="rate-5" />
                                            <label for="rate-5" class="fas fa-star"></label>
                                            <input type="radio" name="rating" value="4" id="rate-4" />
                                            <label for="rate-4" class="fas fa-star"></label>
                                            <input type="radio" name="rating" value="3" id="rate-3" />
                                            <label for="rate-3" class="fas fa-star"></label>
                                            <input type="radio" name="rating" value="2" id="rate-2" />
                                            <label for="rate-2" class="fas fa-star"></label>
                                            <input type="radio" name="rating" value="1" id="rate-1" />
                                            <label for="rate-1" class="fas fa-star"></label>
                                        </div>
                                        <div class="row form">
                                            <div class="col-sm-6">
                                                <input asp-for="Fullname" type="text" placeholder="Họ tên">
                                            </div>
                                            <div class="col-sm-6">
                                                <input asp-for="Email" type="email" placeholder="Email">
                                            </div>
                                            <div class="col-sm-12">
                                                <textarea asp-for="Comment" placeholder="Nội dung đánh giá"></textarea>
                                            </div>
                                            <div class="col-sm-12">
                                                <button class="btn btn-outline-info">Đánh giá</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Product Detail End -->

@if (relatedProducts.Count > 0)
{
    <div class="product py-3 mb-4">
        <div class="container">
            <div class="section-header">
                <h1>Sản Phẩm Liên Quan</h1>
            </div>
            @* @await Html.PartialAsync("_ProductSliderPartial", relatedProducts) *@

            <div class="row align-items-center product-slider product-slider-4">
                @foreach (var p in relatedProducts)
                {
                    <div class="col-lg-3">
                        <div class="product-item">
                            <div class="product-image">
                                <div class="discount-per">
                                    <span>-@Math.Truncate(p.DiscountRate)%</span>
                                </div>
                                <a asp-controller="Product" asp-action="Detail"><img src="~/img/products/@p.Thumbnail"></a>
                            </div>
                            <div class="product-title"><a asp-controller="Product" asp-action="Detail">@p.Name</a></div>
                            <div class="product-price">
                                <p class="price-discount"><span>@Math.Truncate(p.Price * (1 - p.DiscountRate / 100))đ</span></p>
                                <p class="price"><span>@Math.Truncate(p.Price)đ</span></p>
                            </div>
                            <div class="view-rating">
                                <span class="view">23<i class="fa fa-eye"></i></span>
                                <span class="rating">4.7/5<i class="fa fa-star"></i></span>
                            </div>
                            <div class="btn-add-cart">
                                <button>Thêm vào giỏ hàng</button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
}